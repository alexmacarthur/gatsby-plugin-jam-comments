/**
  *
  * JamComments
  * Author: Alex MacArthur <alex@macarthur.me> (https://macarthur.me)
  * Version: v0.0.11
  * License: GPL-2.0
  * URL: https://jamcomments.com
  *
  */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).JamComments=t(e.React)}(this,(function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=t(e);function r(e,t,n,r,a,o,i){try{var c=e[o](i),m=c.value}catch(e){return void n(e)}c.done?t(m):Promise.resolve(m).then(r,a)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(a,o){var i=e.apply(t,n);function c(e){r(i,a,o,c,m,"next",e)}function m(e){r(i,a,o,c,m,"throw",e)}c(void 0)}))}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}(e,t)||s(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||s(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===n&&r.firstChild?r.insertBefore(a,r.firstChild):r.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}}d(".jc-Message {\n  margin-bottom: 1rem;\n  border-radius: var(--border-radius);\n  padding: .75rem 1rem;\n  color: white; }\n  .jc-Message p {\n    margin: 0; }\n\n.jc-Message--error {\n  background: var(--jc-red); }\n\n.jc-Message--success {\n  background: var(--jc-green); }\n");var f=function(e){var t=e.children,r=e.isSuccessful,a=void 0!==r&&r?"jc-Message--success":"jc-Message--error";return n.default.createElement("div",{className:"jc-Message ".concat(a)},n.default.createElement("p",null,t))};d(".jc-CommentBox {\n  position: relative; }\n  .jc-CommentBox-loadingDots {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translateX(-50%); }\n    .jc-CommentBox-loadingDots svg {\n      fill: var(--jc-loading); }\n  .jc-CommentBox-attribution {\n    opacity: .5;\n    text-align: right;\n    padding-top: 5px;\n    font-size: .65em; }\n    .jc-CommentBox-attribution a {\n      text-decoration: none;\n      color: inherit; }\n  .jc-CommentBox-inputs.is-submitting {\n    opacity: .15;\n    pointer-events: none; }\n  .jc-CommentBox-form {\n    display: grid;\n    grid-template-columns: 1fr;\n    grid-gap: 1rem;\n    margin-bottom: 30px; }\n    @media screen and (min-width: 900px) {\n      .jc-CommentBox-form {\n        grid-template-columns: 1fr 1fr; } }\n  .jc-CommentBox input,\n  .jc-CommentBox textarea {\n    border: 2px solid var(--jc-gray);\n    border-radius: var(--border-radius);\n    padding: 8px; }\n  .jc-CommentBox textarea {\n    min-height: 100px; }\n  .jc-CommentBox-textarea, .jc-CommentBox-buttonWrapper {\n    grid-column: 1 / -1; }\n  .jc-CommentBox-buttonWrapper {\n    margin-top: 1.5rem; }\n  .jc-CommentBox-label {\n    display: flex;\n    flex-direction: column; }\n    .jc-CommentBox-label input,\n    .jc-CommentBox-label textarea {\n      margin-top: 3px; }\n");function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var g=({styles:e={},...t})=>n.default.createElement("svg",p({width:"120",height:"30",xmlns:"http://www.w3.org/2000/svg",fill:"#fff"},t),n.default.createElement("circle",{cx:"15",cy:"15",r:"15"},n.default.createElement("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),n.default.createElement("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"})),n.default.createElement("circle",{cx:"60",cy:"15",r:"9",fillOpacity:".3"},n.default.createElement("animate",{attributeName:"r",from:"9",to:"9",begin:"0s",dur:"0.8s",values:"9;15;9",calcMode:"linear",repeatCount:"indefinite"}),n.default.createElement("animate",{attributeName:"fill-opacity",from:".5",to:".5",begin:"0s",dur:"0.8s",values:".5;1;.5",calcMode:"linear",repeatCount:"indefinite"})),n.default.createElement("circle",{cx:"105",cy:"15",r:"15"},n.default.createElement("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),n.default.createElement("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"})));function v(e){return b.apply(this,arguments)}function b(){return(b=a(regeneratorRuntime.mark((function e(t){var n,r,a,o,i,m,l,s,u,d,f,p,g,v,b,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.endpoint,r=t.fetchOptions,a=t.query,o=t.variables,i={query:a,variables:JSON.stringify(o)},m=r.method,l=void 0===m?"POST":m,s=r.headers,u=void 0===s?{}:s,d="get"===l.toLowerCase(),f=d?function(e,t){var n=new URL(e);for(var r in t)n.searchParams.append(r,t[r]);return n.toString()}(n,i):n,e.prev=2,e.next=5,fetch(f,{method:l.toUpperCase(),headers:c({"Content-Type":"application/"+(d?"x-www-form-urlencoded":"json")},u),body:d?null:JSON.stringify(i)});case 5:return p=e.sent,e.next=8,p.json();case 8:return g=e.sent,v=g.data,b=g.errors,h={data:v},e.abrupt("return",(b&&(h.errors=b),h));case 15:return e.prev=15,e.t0=e.catch(2),e.abrupt("return",{errors:[e.t0]});case 18:case"end":return e.stop()}}),e,null,[[2,15]])})))).apply(this,arguments)}var h=function(e){var t,n=e.endpoint,r=e.method,o=e.headers;return{send:(t=a(regeneratorRuntime.mark((function e(t){var a,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>1&&void 0!==i[1]?i[1]:{},e.next=3,v({endpoint:n,query:t,variables:a,fetchOptions:{method:r,headers:o}});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}}({endpoint:"".concat(function(){var e,t;return(null===(e=process)||void 0===e||null===(t=e.env)||void 0===t?void 0:t.JAM_COMMENTS_SERVICE_ENDPOINT)||"https://service.jamcomments.com"}(process.env.JAM_COMMENTS_SERVICE_ENDPOINT),"/graphql"),headers:{"x-api-key":process.env.GATSBY_JAM_COMMENTS_API_KEY}}),j=process.env.GATSBY_JAM_COMMENTS_DOMAIN,y=function(){return(new Date).getTime()},C=function(t){var r=t.newComment,o=function(){var t=e.useRef(!1);return e.useEffect((function(){return t.current=!0,function(){return t.current=!1}}),[]),t}(),i=e.useRef(null),c=m(e.useState(!1),2),s=c[0],u=c[1],d=m(e.useState(""),2),p=d[0],v=d[1],b=m(e.useState(!1),2),C=b[0],x=b[1],E=function(){var e=a(regeneratorRuntime.mark((function e(t){var n,a,c,m,s,d,f,p,g,b;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=y(),t.preventDefault(),v(""),u(!0),C=i.current,a=l(C.elements).reduce((function(e,t){return e[t.name]=t.value,e}),{}),i.current.reset(),"\n      mutation CreateComment(\n        $name: String!,\n        $path: String!,\n        $content: String!,\n        $domain: String!,\n        $emailAddress: String\n      ){\n        createComment(\n          name: $name,\n          path: $path,\n          content: $content,\n          emailAddress: $emailAddress\n          domain: $domain\n        ) {\n          createdAt\n          name\n          emailAddress\n          content\n          id\n          site {\n            domain\n          }\n        }\n      }\n    ",c=a.name,m=a.content,s=a.emailAddress,d={name:c,domain:j,content:m,emailAddress:s,path:window.location.pathname},e.prev=9,e.next=12,h.send("\n      mutation CreateComment(\n        $name: String!,\n        $path: String!,\n        $content: String!,\n        $domain: String!,\n        $emailAddress: String\n      ){\n        createComment(\n          name: $name,\n          path: $path,\n          content: $content,\n          emailAddress: $emailAddress\n          domain: $domain\n        ) {\n          createdAt\n          name\n          emailAddress\n          content\n          id\n          site {\n            domain\n          }\n        }\n      }\n    ",d);case 12:if(f=e.sent,!(null===(p=f)||void 0===p||null===(g=p.errors)||void 0===g?void 0:g.length)){e.next=17;break}return console.log(f.errors[0].message),v("Sorry, something went wrong!"),e.abrupt("return");case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(9),v("Sorry, something went wrong!"),u(!1);case 23:return e.prev=23,b=1e3-(y()-n),setTimeout((function(){var e,t;o.current&&(u(!1),(null===(e=f)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.createComment)&&r(f.data.createComment))}),b>0?b:0),e.finish(23);case 28:case"end":return e.stop()}var C}),e,null,[[9,19,23,28]])})));return function(t){return e.apply(this,arguments)}}();return n.default.createElement("div",{className:"jc-CommentBox"},s&&n.default.createElement("div",{className:"jc-CommentBox-loadingDots"},n.default.createElement(g,null)),n.default.createElement("div",{className:"jc-CommentBox-inputs ".concat(s?"is-submitting":"")},n.default.createElement("h3",null,"Leave a Comment"),p&&n.default.createElement(f,null,p),n.default.createElement("form",{onSubmit:E,ref:i,className:"jc-CommentBox-form"},n.default.createElement("label",{className:"jc-CommentBox-label jc-CommentBox-textarea"},n.default.createElement("textarea",{name:"content",required:!0,onFocus:function(){return!C&&x(!0)}}),n.default.createElement("small",{className:"jc-CommentBox-attribution"},"Powered by"," ",n.default.createElement("a",{tabIndex:"-1",href:"https://jamcomments.com",rel:"noreferrer noopener",target:"_blank"},"JamComments"))),C&&n.default.createElement(n.default.Fragment,null,n.default.createElement("label",{className:"jc-CommentBox-label"},"Name",n.default.createElement("input",{type:"text",name:"name",required:!0})),n.default.createElement("label",{className:"jc-CommentBox-label"},"Email Address",n.default.createElement("input",{type:"email",name:"emailAddress"})),n.default.createElement("span",{className:"jc-CommentBox-buttonWrapper"},n.default.createElement("button",{className:"jc-CommentBox-button"},"Submit"))))))},x=function(e){return new Date(Number(e))};d(".jc-Comment * {\n  font: inherit; }\n\n.jc-Comment-details {\n  display: flex;\n  align-items: center;\n  color: var(--jc-gray-dark);\n  margin-bottom: 15px; }\n\n.jc-Comment-content {\n  padding-bottom: 12px; }\n\n.jc-Comment-name {\n  margin: 0;\n  font-weight: bold; }\n\n.jc-Comment-date {\n  line-height: normal;\n  font-size: .75em;\n  color: var(--jc-gray-dark);\n  display: block; }\n\n.jc-Comment-anchor {\n  padding: 0 .05rem 0 .5rem;\n  font-weight: bold;\n  text-decoration: none;\n  color: inherit;\n  font-weight: normal; }\n  .jc-Comment-anchor:visited {\n    color: inherit; }\n");var E=function(t){var r,a=t.comment;return a.content=e.useMemo((function(){return a.content.replace(/\n/g,"<br>\n")}),[]),n.default.createElement("div",{className:"jc-Comment"},n.default.createElement("span",{className:"jc-Comment-details"},n.default.createElement("h6",{className:"jc-Comment-name"},a.name),n.default.createElement("a",{className:"jc-Comment-anchor",href:"#comment-".concat(a.id),"aria-label":"comment anchor link"},n.default.createElement("time",{className:"jc-Comment-date",dateTime:(r=a.createdAt,x(r).toISOString())},function(e){var t=x(e),n=t.getTimezoneOffset()/60;return t.setHours(t.getHours()-n),t.toLocaleString("en-US").split(",")[0].trim()}(a.createdAt)))),n.default.createElement("div",{className:"jc-Comment-content"},n.default.createElement("p",{dangerouslySetInnerHTML:{__html:a.content}})))};d(".jc-CommentList {\n  overflow: hidden; }\n  .jc-CommentList-count {\n    position: relative;\n    display: inline-block;\n    margin-bottom: 1rem; }\n    .jc-CommentList-count:after {\n      content: '';\n      display: block;\n      position: absolute;\n      width: 100vw;\n      height: 2px;\n      background: var(--jc-gray);\n      top: 50%;\n      left: calc(100% + 20px);\n      transform: translateY(-50%); }\n  .jc-CommentList-list {\n    list-style: none;\n    padding: 0;\n    margin: 0; }\n  .jc-CommentList-item {\n    position: relative;\n    margin-top: 2rem; }\n    .jc-CommentList-item:after {\n      content: '';\n      display: block;\n      position: absolute;\n      width: 100vw;\n      height: 2px;\n      background: var(--jc-gray);\n      top: 50%;\n      left: calc(100% + 20px);\n      transform: translateY(-50%); }\n    .jc-CommentList-item:after {\n      position: relative;\n      width: 50px;\n      left: 0;\n      top: auto;\n      transform: none;\n      margin-bottom: 2rem; }\n    .jc-CommentList-item:last-child {\n      margin-top: 0; }\n");var w=function(e){var t,r=e.comments;return n.default.createElement("div",{className:"jc-CommentList"},n.default.createElement("span",{className:"jc-CommentList-count"},r.length," ",(t="comment",1===r.length?t:"".concat(t,"s"))),n.default.createElement("ul",{className:"jc-CommentList-list"},r.map((function(e){return n.default.createElement("li",{key:e.id,className:"jc-CommentList-item"},n.default.createElement(E,{comment:e}))}))))};d(".jc-Shell {\n  --jc-red: #BA274A;\n  --jc-green: #5BBA6F;\n  --jc-gray: #dfdede;\n  --jc-gray-dark: #5c5c5c;\n  --border-radius: 5px;\n  --jc-loading: var(--jc-gray);\n  margin: 2rem 0; }\n");return function(t){var r=t.pageContext,a=r&&r.comments?r.comments:[],o=m(e.useState(a),2),i=o[0],c=o[1];return n.default.createElement("div",{className:"jc-Shell"},n.default.createElement(C,{newComment:function(e){c([e].concat(l(i)))}}),n.default.createElement(w,{comments:i}))}}));
