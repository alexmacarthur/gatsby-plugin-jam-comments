/**
  *
  * JamComments
  * Author: Alex MacArthur <alex@macarthur.me> (https://macarthur.me)
  * Version: v0.0.5
  * License: MIT
  * URL: https://github.com/alexmacarthur/gatsby-plugin-jam-comments#readme
  *
  */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("react")):"function"==typeof define&&define.amd?define(["react"],n):(e=e||self).JamComments=n(e.React)}(this,(function(e){"use strict";var n="default"in e?e.default:e;function t(e,n,t,r,a,o,i){try{var m=e[o](i),c=m.value}catch(e){return void t(e)}m.done?n(c):Promise.resolve(c).then(r,a)}function r(e){return function(){var n=this,r=arguments;return new Promise((function(a,o){var i=e.apply(n,r);function m(e){t(i,a,o,m,c,"next",e)}function c(e){t(i,a,o,m,c,"throw",e)}m(void 0)}))}}function a(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],r=!0,a=!1,o=void 0;try{for(var i,m=e[Symbol.iterator]();!(r=(i=m.next()).done)&&(t.push(i.value),!n||t.length!==n);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==m.return||m.return()}finally{if(a)throw o}}return t}(e,n)||i(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,n){if(e){if("string"==typeof e)return m(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?m(e,n):void 0}}function m(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function c(e,n){void 0===n&&(n={});var t=n.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===t&&r.firstChild?r.insertBefore(a,r.firstChild):r.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}}c(".jc-Message {\n  margin-bottom: 1rem;\n  border-radius: var(--border-radius);\n  padding: .75rem 1rem;\n  color: white; }\n  .jc-Message p {\n    margin: 0; }\n\n.jc-Message--error {\n  background: var(--jc-red); }\n\n.jc-Message--success {\n  background: var(--jc-green); }\n");var l=function(e){var t=e.children,r=e.isSuccessful,a=void 0!==r&&r?"jc-Message--success":"jc-Message--error";return n.createElement("div",{className:"jc-Message ".concat(a)},n.createElement("p",null,t))};c(".jc-CommentBox {\n  position: relative; }\n  .jc-CommentBox-loadingDots {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translateX(-50%); }\n    .jc-CommentBox-loadingDots svg {\n      fill: var(--jc-loading); }\n  .jc-CommentBox-attribution {\n    opacity: .5;\n    text-align: right;\n    padding-top: 5px;\n    font-size: .65em; }\n    .jc-CommentBox-attribution a {\n      text-decoration: none;\n      color: inherit; }\n  .jc-CommentBox-inputs.is-submitting {\n    opacity: .15;\n    pointer-events: none; }\n  .jc-CommentBox-form {\n    display: grid;\n    grid-template-columns: 1fr;\n    grid-gap: 1rem;\n    margin-bottom: 30px; }\n    @media screen and (min-width: 900px) {\n      .jc-CommentBox-form {\n        grid-template-columns: 1fr 1fr; } }\n  .jc-CommentBox input,\n  .jc-CommentBox textarea {\n    border: 2px solid var(--jc-gray);\n    border-radius: var(--border-radius);\n    padding: 8px; }\n  .jc-CommentBox textarea {\n    min-height: 100px; }\n  .jc-CommentBox-textarea, .jc-CommentBox-buttonWrapper {\n    grid-column: 1 / -1; }\n  .jc-CommentBox-buttonWrapper {\n    margin-top: 1.5rem; }\n  .jc-CommentBox-label {\n    display: flex;\n    flex-direction: column; }\n    .jc-CommentBox-label input,\n    .jc-CommentBox-label textarea {\n      margin-top: 3px; }\n");var s=function(){var e=r(regeneratorRuntime.mark((function e(){var n,t,r,a,o,i,m=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=m.length>0&&void 0!==m[0]?m[0]:{},t=n.apiKey,r=n.query,a=n.variables,o=void 0===a?{}:a,e.next=3,fetch("http://localhost:4000/graphql",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":t},body:JSON.stringify({query:r,variables:o})});case 3:return i=e.sent,e.next=6,i.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function u(){return(u=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}var d=({styles:e={},...t})=>n.createElement("svg",u({width:"120",height:"30",xmlns:"http://www.w3.org/2000/svg",fill:"#fff"},t),n.createElement("circle",{cx:"15",cy:"15",r:"15"},n.createElement("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),n.createElement("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"})),n.createElement("circle",{cx:"60",cy:"15",r:"9",fillOpacity:".3"},n.createElement("animate",{attributeName:"r",from:"9",to:"9",begin:"0s",dur:"0.8s",values:"9;15;9",calcMode:"linear",repeatCount:"indefinite"}),n.createElement("animate",{attributeName:"fill-opacity",from:".5",to:".5",begin:"0s",dur:"0.8s",values:".5;1;.5",calcMode:"linear",repeatCount:"indefinite"})),n.createElement("circle",{cx:"105",cy:"15",r:"15"},n.createElement("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),n.createElement("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"}))),p=process.env.GATSBY_JAM_COMMENTS_API_KEY,f=process.env.GATSBY_JAM_COMMENTS_DOMAIN,g=function(){return(new Date).getTime()},v=function(t){var i=t.newComment,m=function(){var n=e.useRef(!1);return e.useEffect((function(){return n.current=!0,function(){return n.current=!1}}),[]),n}(),c=e.useRef(null),u=a(e.useState(!1),2),v=u[0],b=u[1],h=a(e.useState(""),2),j=h[0],y=h[1],C=a(e.useState(!1),2),x=C[0],E=C[1],S=function(){var e=r(regeneratorRuntime.mark((function e(n){var t,r,a,l,u,d,v,h,j;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=g(),n.preventDefault(),y(""),b(!0),C=c.current,r=o(C.elements).reduce((function(e,n){return e[n.name]=n.value,e}),{}),c.current.reset(),"\n      mutation CreateComment(\n        $name: String!,\n        $path: String!,\n        $content: String!,\n        $domain: String!,\n        $emailAddress: String\n      ){\n        createComment(\n          name: $name,\n          path: $path,\n          content: $content,\n          emailAddress: $emailAddress\n          domain: $domain\n        ) {\n          createdAt\n          name\n          emailAddress\n          content\n          id\n          site {\n            domain\n          }\n        }\n      }\n    ",a=r.name,l=r.content,u=r.emailAddress,d={name:a,domain:f,content:l,emailAddress:u,path:window.location.pathname},e.prev=9,e.next=12,s({apiKey:p,query:"\n      mutation CreateComment(\n        $name: String!,\n        $path: String!,\n        $content: String!,\n        $domain: String!,\n        $emailAddress: String\n      ){\n        createComment(\n          name: $name,\n          path: $path,\n          content: $content,\n          emailAddress: $emailAddress\n          domain: $domain\n        ) {\n          createdAt\n          name\n          emailAddress\n          content\n          id\n          site {\n            domain\n          }\n        }\n      }\n    ",variables:d});case 12:if(v=e.sent,!(null===(h=v)||void 0===h?void 0:h.errors)||!v.errors.length){e.next=17;break}return console.log(v.errors[0].message),y("Sorry, something went wrong!"),e.abrupt("return");case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(9),y("Sorry, something went wrong!"),b(!1);case 23:return e.prev=23,j=1e3-(g()-t),setTimeout((function(){var e,n;m.current&&(b(!1),(null===(e=v)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.createComment)&&i(v.data.createComment))}),j>0?j:0),e.finish(23);case 28:case"end":return e.stop()}var C}),e,null,[[9,19,23,28]])})));return function(n){return e.apply(this,arguments)}}();return n.createElement("div",{className:"jc-CommentBox"},v&&n.createElement("div",{className:"jc-CommentBox-loadingDots"},n.createElement(d,null)),n.createElement("div",{className:"jc-CommentBox-inputs ".concat(v?"is-submitting":"")},n.createElement("h3",null,"Leave a Comment"),j&&n.createElement(l,null,j),n.createElement("form",{onSubmit:S,ref:c,className:"jc-CommentBox-form"},n.createElement("label",{className:"jc-CommentBox-label jc-CommentBox-textarea"},n.createElement("textarea",{name:"content",required:!0,onFocus:function(){return!x&&E(!0)}}),n.createElement("small",{className:"jc-CommentBox-attribution"},"Powered by ",n.createElement("a",{tabIndex:"-1",href:"https://jamcomments.com",rel:"noreferrer noopener",target:"_blank"},"JamComments"))),x&&n.createElement(n.Fragment,null,n.createElement("label",{className:"jc-CommentBox-label"},"Name",n.createElement("input",{type:"text",name:"name",required:!0})),n.createElement("label",{className:"jc-CommentBox-label"},"Email Address",n.createElement("input",{type:"email",name:"emailAddress"})),n.createElement("span",{className:"jc-CommentBox-buttonWrapper"},n.createElement("button",{className:"jc-CommentBox-button"},"Submit"))))))},b=function(e){return new Date(Number(e))};c(".jc-Comment * {\n  font: inherit; }\n\n.jc-Comment-details {\n  display: flex;\n  align-items: center;\n  color: var(--jc-gray-dark);\n  margin-bottom: 15px; }\n\n.jc-Comment-content {\n  padding-bottom: 12px; }\n\n.jc-Comment-name {\n  margin: 0;\n  font-weight: bold; }\n\n.jc-Comment-date {\n  line-height: normal;\n  font-size: .75em;\n  color: var(--jc-gray-dark);\n  display: block; }\n\n.jc-Comment-anchor {\n  padding: 0 .05rem 0 .5rem;\n  font-weight: bold;\n  text-decoration: none;\n  color: inherit;\n  font-weight: normal; }\n  .jc-Comment-anchor:visited {\n    color: inherit; }\n");var h=function(t){var r,a=t.comment;return a.content=e.useMemo((function(){return a.content.replace(/\n/g,"<br>\n")}),[]),n.createElement("div",{className:"jc-Comment"},n.createElement("span",{className:"jc-Comment-details"},n.createElement("h6",{className:"jc-Comment-name"},a.name),n.createElement("a",{className:"jc-Comment-anchor",href:"#comment-".concat(a.id),"aria-label":"comment anchor link"},n.createElement("time",{className:"jc-Comment-date",dateTime:(r=a.createdAt,b(r).toISOString())},function(e){var n=b(e),t=n.getTimezoneOffset()/60;return n.setHours(n.getHours()-t),n.toLocaleString("en-US").split(",")[0].trim()}(a.createdAt)))),n.createElement("div",{className:"jc-Comment-content"},n.createElement("p",{dangerouslySetInnerHTML:{__html:a.content}})))};c(".jc-CommentList {\n  overflow: hidden; }\n  .jc-CommentList-count {\n    position: relative;\n    display: inline-block;\n    margin-bottom: 1rem; }\n    .jc-CommentList-count:after {\n      content: '';\n      display: block;\n      position: absolute;\n      width: 100vw;\n      height: 2px;\n      background: var(--jc-gray);\n      top: 50%;\n      left: calc(100% + 20px);\n      transform: translateY(-50%); }\n  .jc-CommentList-list {\n    list-style: none;\n    padding: 0;\n    margin: 0; }\n  .jc-CommentList-item {\n    position: relative;\n    margin-top: 2rem; }\n    .jc-CommentList-item:after {\n      content: '';\n      display: block;\n      position: absolute;\n      width: 100vw;\n      height: 2px;\n      background: var(--jc-gray);\n      top: 50%;\n      left: calc(100% + 20px);\n      transform: translateY(-50%); }\n    .jc-CommentList-item:after {\n      position: relative;\n      width: 50px;\n      left: 0;\n      top: auto;\n      transform: none;\n      margin-bottom: 2rem; }\n    .jc-CommentList-item:last-child {\n      margin-top: 0; }\n");var j=function(e){var t,r=e.comments;return n.createElement("div",{className:"jc-CommentList"},n.createElement("span",{className:"jc-CommentList-count"},r.length," ",(t="comment",1===r.length?t:"".concat(t,"s"))),n.createElement("ul",{className:"jc-CommentList-list"},r.map((function(e){return n.createElement("li",{key:e.id,className:"jc-CommentList-item"},n.createElement(h,{comment:e}))}))))};c(".jc-Shell {\n  --jc-red: #BA274A;\n  --jc-green: #5BBA6F;\n  --jc-gray: #dfdede;\n  --jc-gray-dark: #5c5c5c;\n  --border-radius: 5px;\n  --jc-loading: var(--jc-gray);\n  margin: 2rem 0; }\n");return function(t){var r=t.pageContext,i=r&&r.comments?r.comments:[],m=a(e.useState(i),2),c=m[0],l=m[1];return n.createElement("div",{className:"jc-Shell"},n.createElement(v,{newComment:function(e){l([e].concat(o(c)))}}),n.createElement(j,{comments:c}))}}));
