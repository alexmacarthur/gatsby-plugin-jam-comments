/**
  *
  * JamComments
  * Author: Alex MacArthur <alex@macarthur.me> (https://macarthur.me)
  * Version: v0.0.2
  * License: MIT
  * URL: https://github.com/alexmacarthur/gatsby-plugin-jam-comments#readme
  *
  */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("react")):"function"==typeof define&&define.amd?define(["react"],n):(e=e||self).JamComments=n(e.React)}(this,(function(e){"use strict";var n="default"in e?e.default:e;function t(e,n,t,r,a,o,m){try{var c=e[o](m),i=c.value}catch(e){return void t(e)}c.done?n(i):Promise.resolve(i).then(r,a)}function r(e){return function(){var n=this,r=arguments;return new Promise((function(a,o){var m=e.apply(n,r);function c(e){t(m,a,o,c,i,"next",e)}function i(e){t(m,a,o,c,i,"throw",e)}c(void 0)}))}}function a(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],r=!0,a=!1,o=void 0;try{for(var m,c=e[Symbol.iterator]();!(r=(m=c.next()).done)&&(t.push(m.value),!n||t.length!==n);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return t}(e,n)||m(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||m(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,n){if(e){if("string"==typeof e)return c(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?c(e,n):void 0}}function c(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function i(e,n){void 0===n&&(n={});var t=n.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===t&&r.firstChild?r.insertBefore(a,r.firstChild):r.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}}i(".jc-Message {\n  margin-bottom: 1rem;\n  border-radius: var(--border-radius);\n  padding: .75rem 1rem;\n  color: white; }\n  .jc-Message p {\n    margin: 0; }\n\n.jc-Message--error {\n  background: var(--jc-red); }\n\n.jc-Message--success {\n  background: var(--jc-green); }\n");var s=function(e){var t=e.children,r=e.isSuccessful,a=void 0!==r&&r?"jc-Message--success":"jc-Message--error";return n.createElement("div",{className:"jc-Message ".concat(a)},n.createElement("p",null,t))};i(".jc-CommentBox-form {\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-gap: 1rem;\n  margin-bottom: 30px; }\n  @media screen and (min-width: 900px) {\n    .jc-CommentBox-form {\n      grid-template-columns: 1fr 1fr; } }\n\n.jc-CommentBox input, .jc-CommentBox textarea {\n  border: 2px solid var(--jc-gray);\n  border-radius: var(--border-radius); }\n\n.jc-CommentBox-textarea, .jc-CommentBox-buttonWrapper {\n  grid-column: 1 / -1; }\n\n.jc-CommentBox-buttonWrapper {\n  margin-top: 1.5rem; }\n\n.jc-CommentBox-label {\n  display: flex;\n  flex-direction: column; }\n  .jc-CommentBox-label input, .jc-CommentBox-label textarea {\n    margin-top: 3px; }\n");var l=function(){var e="development"===process.env.NODE_ENV?"http://localhost:4000":"https://service.jamcomments.com";return"".concat(e,"/graphql")},u=function(){var e=r(regeneratorRuntime.mark((function e(){var n,t,r,a,o,m,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>0&&void 0!==c[0]?c[0]:{},t=n.apiKey,r=n.query,a=n.variables,o=void 0===a?{}:a,e.next=3,fetch(l(),{method:"POST",headers:{"Content-Type":"application/json","x-api-key":t},body:JSON.stringify({query:r,variables:o})});case 3:return m=e.sent,e.next=6,m.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),d=process.env.GATSBY_JAM_COMMENTS_API_KEY,p=process.env.GATSBY_JAM_COMMENTS_DOMAIN,f=function(t){var m=t.newComment,c=e.useRef(null),i=a(e.useState(""),2),l=i[0],f=i[1],g=a(e.useState(""),2),h=g[0],v=g[1],b=a(e.useState(!1),2),j=b[0],y=b[1],C=function(){var e=r(regeneratorRuntime.mark((function e(n){var t,r,a,i,s,l,g;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),v(""),f(""),h=c.current,t=o(h.elements).reduce((function(e,n){return e[n.name]=n.value,e}),{}),c.current.reset(),"\n      mutation CreateComment(\n        $name: String!, \n        $path: String!, \n        $content: String!, \n        $domain: String!,\n        $emailAddress: String\n      ){\n        createComment(\n          name: $name, \n          path: $path, \n          content: $content, \n          emailAddress: $emailAddress\n          domain: $domain\n        ) {\n          domain\n          createdAt\n          name\n          emailAddress\n          content\n          id\n        }\n      }\n    ",r=t.name,a=t.content,i=t.emailAddress,s={name:r,domain:p,content:a,emailAddress:i,path:window.location.pathname},e.prev=8,e.next=11,u({apiKey:d,query:"\n      mutation CreateComment(\n        $name: String!, \n        $path: String!, \n        $content: String!, \n        $domain: String!,\n        $emailAddress: String\n      ){\n        createComment(\n          name: $name, \n          path: $path, \n          content: $content, \n          emailAddress: $emailAddress\n          domain: $domain\n        ) {\n          domain\n          createdAt\n          name\n          emailAddress\n          content\n          id\n        }\n      }\n    ",variables:s});case 11:if(!(null==(g=e.sent)?void 0:g.errors)||!g.errors.length){e.next=16;break}return console.log(g.errors[0].message),v("Sorry, something went wrong!"),e.abrupt("return");case 16:if(!(null==g||null===(l=g.data)||void 0===l?void 0:l.createComment)){e.next=19;break}return f("Comment successfully submitted!"),e.abrupt("return",m(g.data.createComment));case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(8),v("Sorry, something went wrong!");case 24:case"end":return e.stop()}var h}),e,null,[[8,21]])})));return function(n){return e.apply(this,arguments)}}();return n.createElement("div",{className:"jc-CommentBox"},l&&n.createElement(s,{isSuccessful:!0},l),h&&n.createElement(s,null,h),n.createElement("h3",null,"Leave a Comment"),n.createElement("form",{onSubmit:C,ref:c,className:"jc-CommentBox-form"},n.createElement("label",{className:"jc-CommentBox-label jc-CommentBox-textarea"},n.createElement("textarea",{name:"content",required:!0,onFocus:function(){return!j&&y(!0)}})),j&&n.createElement(n.Fragment,null,n.createElement("label",{className:"jc-CommentBox-label"},"Name",n.createElement("input",{type:"text",name:"name",required:!0})),n.createElement("label",{className:"jc-CommentBox-label"},"Email Address",n.createElement("input",{type:"email",name:"emailAddress"})),n.createElement("span",{className:"jc-CommentBox-buttonWrapper"},n.createElement("button",{className:"jc-CommentBox-button"},"Submit")))))},g=function(e){return new Date(Number(e))};i(".jc-Comment * {\n  font: inherit; }\n\n.jc-Comment-details {\n  display: flex;\n  align-items: center;\n  color: var(--jc-gray-dark);\n  margin-bottom: 15px; }\n\n.jc-Comment-name {\n  margin: 0;\n  font-weight: bold; }\n\n.jc-Comment-date {\n  line-height: normal;\n  font-size: .75em;\n  color: var(--jc-gray-dark);\n  display: block; }\n\n.jc-Comment-anchor {\n  padding: 0 .05rem 0 .5rem;\n  font-weight: bold;\n  text-decoration: none;\n  color: inherit;\n  font-weight: normal; }\n  .jc-Comment-anchor:visited {\n    color: inherit; }\n");var h=function(t){var r,a=t.comment;return a.content=e.useMemo((function(){return a.content.replace(/\n/g,"<br>\n")}),[]),n.createElement("div",{className:"jc-Comment"},n.createElement("span",{className:"jc-Comment-details"},n.createElement("h6",{className:"jc-Comment-name"},a.name),n.createElement("a",{className:"jc-Comment-anchor",href:"#comment-".concat(a.id),"aria-label":"comment anchor link"},n.createElement("time",{className:"jc-Comment-date",dateTime:(r=a.createdAt,g(r).toISOString())},function(e){var n=g(e),t=n.getTimezoneOffset()/60;return n.setHours(n.getHours()-t),n.toLocaleString("en-US").split(",")[0].trim()}(a.createdAt)))),n.createElement("div",{className:"jc-Comment-content"},n.createElement("p",{dangerouslySetInnerHTML:{__html:a.content}})))};i(".jc-CommentList {\n  overflow: hidden; }\n  .jc-CommentList-count {\n    position: relative;\n    display: inline-block;\n    margin-bottom: 1rem; }\n    .jc-CommentList-count:after {\n      content: '';\n      display: block;\n      position: absolute;\n      width: 100vw;\n      height: 2px;\n      background: var(--jc-gray);\n      top: 50%;\n      left: calc(100% + 20px);\n      transform: translateY(-50%); }\n  .jc-CommentList-list {\n    list-style: none;\n    padding: 0;\n    margin: 0; }\n  .jc-CommentList-item {\n    position: relative;\n    margin-top: 2rem; }\n    .jc-CommentList-item:after {\n      content: '';\n      display: block;\n      position: absolute;\n      width: 100vw;\n      height: 2px;\n      background: var(--jc-gray);\n      top: 50%;\n      left: calc(100% + 20px);\n      transform: translateY(-50%); }\n    .jc-CommentList-item:after {\n      position: relative;\n      width: 50px;\n      left: 0;\n      top: auto;\n      transform: none;\n      margin-bottom: 2rem; }\n    .jc-CommentList-item:last-child {\n      margin-top: 0; }\n");var v=function(e){var t,r=e.comments;return n.createElement("div",{className:"jc-CommentList"},n.createElement("span",{className:"jc-CommentList-count"},r.length," ",(t="comment",1===r.length?t:"".concat(t,"s"))),n.createElement("ul",{className:"jc-CommentList-list"},r.map((function(e){return n.createElement("li",{key:e.id,className:"jc-CommentList-item"},n.createElement(h,{comment:e}))}))))};i(".jc-Shell {\n  --jc-red: #BA274A;\n  --jc-green: #5BBA6F;\n  --jc-gray: #dfdede;\n  --jc-gray-dark: #5c5c5c;\n  --border-radius: 5px;\n  margin: 2rem 0; }\n");return function(t){var r=t.pageContext,m=r&&r.comments?r.comments:[],c=a(e.useState(m),2),i=c[0],s=c[1];return n.createElement("div",{className:"jc-Shell"},n.createElement(f,{newComment:function(e){s([e].concat(o(i)))}}),n.createElement(v,{comments:i}))}}));
